package main

import (
"fmt"
"os"

"github.com/cyw0ng95/v2e/pkg/proc/subprocess"
)

func main() {
// Get process ID from environment or use default
processID := os.Getenv("PROCESS_ID")
if processID == "" {
processID = "cve-meta"
}

// Set up logging using common subprocess framework
logger, err := subprocess.SetupLogging(processID)
if err != nil {
fmt.Fprintf(os.Stderr, "Failed to setup logging: %v\n", err)
os.Exit(1)
}

// Create subprocess instance
sp := subprocess.New(processID)

// TODO: cve-meta service needs to be redesigned
// It should not create its own broker instance.
// Instead, the main broker should spawn cve-local and cve-remote,
// and cve-meta should communicate with them via RPC through the broker.
// See: https://github.com/cyw0ng95/v2e/pull/74

logger.Warn("CVE meta service is currently non-functional - needs redesign to not use internal broker")
logger.Info("CVE meta service started (stub mode)")

// Run with default lifecycle management
subprocess.RunWithDefaults(sp, logger)
}
